<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Item Details - Lost and Found</title>
    <link th:href="@{/css/style.css}" rel="stylesheet"/>
</head>
<body>
    <div class="container">
        <h1>Item Details</h1>

        <div class="nav">
            <a href="/dashboard">Dashboard</a> |
            <a href="/items/all">Browse Items</a> |
            <a href="/logout">Logout</a>
        </div>

        <div th:if="${message}" class="success" th:text="${message}"></div>

        <div class="item-details">
            <h2 th:text="${item.itemname}"></h2>
            <p><strong>Category:</strong> <span th:text="${item.category}"></span></p>
            <p><strong>Status:</strong> <span th:text="${item.status}"></span></p>
            <p><strong>Description:</strong> <span th:text="${item.description}"></span></p>
            <p><strong>Location:</strong> <span th:text="${item.location}"></span></p>
            <p><strong>Date Lost/Found:</strong> <span th:text="${#temporals.format(item.datelostfound, 'dd-MM-yyyy')}"></span></p>
            <p><strong>Contact Info:</strong> <span th:text="${item.contactinfo}"></span></p>
            <p><strong>Reported By:</strong> <span th:text="${item.reporter.username}"></span></p>
            <p><strong>Date Reported:</strong> <span th:text="${#temporals.format(item.datereported, 'dd-MM-yyyy HH:mm')}"></span></p>

            <div class="actions">
                <a th:href="@{/reports/item/{id}(id=${item.id})}">Download PDF</a>
                <span th:if="${session.loggedinuser.id == item.reporter.id or session.loggedinuser.role.name() == 'ADMIN'}">
                    | <a th:href="@{/items/edit/{id}(id=${item.id})}">Edit</a>
                    | <a th:href="@{/items/delete/{id}(id=${item.id})}" onclick="return confirm('Are you sure?')">Delete</a>
                </span>
            </div>
        </div>

        <h3>Discussion Board</h3>
        <div class="comments">
            <div class="comment" th:each="comment : ${item.comments}">
                <div class="comment-header">
                    <strong th:text="${comment.user.username}"></strong> -
                    <span th:text="${#temporals.format(comment.commentdate, 'dd-MM-yyyy HH:mm')}"></span>
                    <span th:if="${session.loggedinuser.id == comment.user.id or session.loggedinuser.role.name() == 'ADMIN'}">
                        - <a th:href="@{/comments/delete/{id}(id=${comment.id})}" onclick="return confirm('Delete this comment?')">Delete</a>
                    </span>
                </div>
                <div class="comment-text" th:text="${comment.commenttext}"></div>
            </div>

            <div th:if="${#lists.isEmpty(item.comments)}" class="no-comments">
                <p>No comments yet. Be the first to comment!</p>
            </div>
        </div>

        <h4>Add Comment</h4>
        <form action="/comments/add" method="post">
            <input type="hidden" name="itemid" th:value="${item.id}"/>
            <div class="form-group">
                <textarea name="commenttext" rows="4" placeholder="Write your comment here..." required></textarea>
            </div>
            <button type="submit">Post Comment</button>
        </form>
    </div>
</body>
</html>
